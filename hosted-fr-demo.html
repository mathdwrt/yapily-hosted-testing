<html>

<head>
    <script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="flex flex-col items-center px-6 py-8">
    <div class="flex flex-col gap-10">
        <div class="flex flex-col gap-5">
            <h1 class="text-3xl font-bold text-center">Test our Payment Journey by Donating €1 to a Charity
            </h1>
            <h2 class="text-2xl text-center">Select your favourite charity below to kick off the payment
                journey and
                proceed with a €1
                donation</h2>
        </div>

        <div class="flex flex-col gap-5">
            <h1 class="text-3xl font-bold text-center">Testez notre méthode de paiement en faisant un don de 1€ à une
                association caritative</h1>
            <h2 class="text-2xl text-center">Sélectionnez votre organisation caritative préférée ci-dessous pour lancer
                le processus de paiement et faire un don de 1€.</h2>
        </div>

        <div class="flex flex-row gap-5 justify-center items-center">
            <div class="p-2 rounded grid place-content-center cursor-pointer h-64 w-64"
                style="border-color: gainsboro; border-width: 1px;" onclick="payUnicef()">
                <img src="https://demo.yapily.com/_nuxt/img/charity-generic-unicef.258749b.png" alt="Unicef" class="">
            </div>
            <div class="p-2 rounded grid place-content-center cursor-pointer h-64 w-64"
                style="border-color: gainsboro; border-width: 1px;" onclick="paySecourPopulaire()">
                <img src="https://demo.yapily.com/_nuxt/img/charity-fr-secours-populaire.5ab7b8d.png"
                    alt="Le Secours Populaire" class="">
            </div>
        </div>


        <script>
            function uniqueID() {
                return Math.floor(Math.random() * Date.now())
            }

            function payByBank(name, iban) {
                fetch("https://demo-backend.yapily.com/hosted/payment-requests", {
                    method: "POST",
                    body: JSON.stringify({
                        "userSettings": {
                            "language": "fr",
                            "location": "FR"
                        },
                        "institutionIdentifiers": {
                            "institutionCountryCode": "FR"
                        },
                        "redirectUrl": "https://mathdwrt.github.io/yapily-hosted-testing/hosted-callback.html",
                        "paymentRequestDetails": {
                            "paymentIdempotencyId": `${uniqueID()}`,
                            "amountDetails": {
                                "amountToPay": "1",
                                "currency": "EUR"
                            },
                            "reference": "Donation",
                            "contextType": "OTHER",
                            "type": "DOMESTIC_PAYMENT",
                            "paymentRail": "FPS",
                            "payee": {
                                "name": name,
                                "accountIdentifications": [
                                    {
                                        "type": "IBAN",
                                        "identification": iban
                                    }
                                ]
                            },
                        }
                    }),
                    headers: {
                        "Content-type": "application/json; charset=UTF-8",
                        "access-control-allow-origin": "*"
                    }
                })
                    .then((response) => response.json())
                    .then(json => window.location.href = `${json.data.hostedUrl}&merchantId=Green`)
            }

            function paySecourPopulaire() {
                payByBank("Le Secours Populaire", "FR4620041000012029874R02026")
            }

            function payUnicef() {
                payByBank("UNICEF", "FR7617515900000852379628548")
            }
        </script>
    </div>
</body>

</html>